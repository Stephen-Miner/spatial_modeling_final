<!DOCTYPE html>
<html lang="en">
<head>
    <title>CPSC 487/587</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lil-gui@0.19.1/dist/lil-gui.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.3.0/math.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quaternion@1.5.1/quaternion.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/numeric@1.2.6/numeric-1.2.6.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stats.js@0.17.0/build/stats.min.js"></script>
    <script type="importmap">
        {
            "imports": {
              "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
              "three/": "https://unpkg.com/three@0.160.0/"
            }
        }
    </script>
</head>
<body>
<script type="module">
    import {ThreeEngine} from "./js/utils/utils_three.js";
    import {TransformGizmoEngine} from "./js/utils/utils_transform_gizmo.js";
    import {get_default_lil_gui} from "./js/utils/utils_three.js";
    import {add_matrix_matrix, mul_matrix_scalar} from "./js/utils/utils_math.js";
    import {refresh_displays} from "./js/utils/utils_three.js";
    import {set_object_pose_from_SE3_matrix} from "./js/utils/utils_transforms.js";
    import {mul_matrix_matrix} from "./js/utils/utils_math.js";


    let engine = ThreeEngine.new_default_3d();

    let earth = {
        t: 0,
        a: 7,
        b: 4,
        theta_1: 0,
        theta_2: 0,
        theta_3: 0,
        speed: 1
    }

    let gui = get_default_lil_gui();

    let earth_controls = gui.addFolder("Earth Controls");
    earth_controls.add(earth, "theta_1", -2 * Math.PI, 2 * Math.PI);
    earth_controls.add(earth, "theta_2", -2 * Math.PI, 2 * Math.PI);
    earth_controls.add(earth, "theta_3", -2 * Math.PI, 2 * Math.PI);
    earth_controls.add(earth, "speed", -3, 3);

    function get_point_from_so3_and_t(so3, t, start_point) {
        //let from_start = mul_matrix_matrix(so3, start_point)
        let translated = add_matrix_matrix(so3, t)
        return translated.flat();
    }

    function get_orbit_points () {

    }

    let earth_start = [[0],[0],[0]];

    engine.animation_loop( ()  => {
        earth.t = earth.t + engine.get_delta_time_from_last_frame() * (earth.speed * Math.PI);

        let earth_so3 = [
            [Math.cos(earth.theta_2) * Math.cos(earth.theta_3), -Math.cos(earth.theta_2)*Math.sin(earth.theta_3), Math.sin(earth.theta_2)],
            [Math.cos(earth.theta_3) * Math.sin(earth.theta_1) * Math.sin(earth.theta_2) + Math.cos(earth.theta_1) * Math.sin(earth.theta_3), Math.cos(earth.theta_1) * Math.cos(earth.theta_3) - Math.sin(earth.theta_1) * Math.sin(earth.theta_2) * Math.sin(earth.theta_3), -Math.cos(earth.theta_2) * Math.sin(earth.theta_1)],
            [-Math.cos(earth.theta_1) * Math.cos(earth.theta_3) * Math.sin(earth.theta_2) + Math.sin(earth.theta_1) * Math.sin(earth.theta_3), Math.cos(earth.theta_3) * Math.sin(earth.theta_1) + Math.cos(earth.theta_1) * Math.sin(earth.theta_2) * Math.sin(earth.theta_3), Math.cos(earth.theta_1) * Math.cos(earth.theta_2)]
        ];

        let earth_t = [
            [earth.a * Math.sin(earth.t)],
            [earth.b * Math.cos(earth.t)],
            [0]
        ];

        let earth_point = mul_matrix_matrix(earth_so3, earth_t, earth_start);

        engine.draw_debug_sphere(earth_point, 0.5, 0x135c1b);
        engine.draw_debug_sphere([0,0,0], 1.0, 0xf6ff47);
    });

</script>
</body>
</html>